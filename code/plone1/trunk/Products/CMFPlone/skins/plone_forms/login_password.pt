<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US"
      lang="en-US"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<body>

<tal:block tal:condition="exists: here/portal_skins | nothing"
           tal:replace="nothing">

    <tal:block tal:condition="here/portal_skins/updateSkinCookie | nothing"
       tal:define="dummy here/setupCurrentSkin" />

</tal:block>

  <metal:block fill-slot="base">
      <tal:block tal:define="dummy python:request.set('disable_border', 1)"
                 tal:replace="nothing">
      Disable the tabs
      </tal:block>
  </metal:block>

<div metal:fill-slot="main">

    <div tal:define="p_props here/portal_properties">
    
        <div tal:define="member python: here.portal_membership.getAuthenticatedMember()">

             <div tal:condition="python:member.getProperty('login_time', None) == '2000/01/01' and p_props.validate_email">

             <metal:block tal:on-error="nothing"
		                      tal:define="dum_reg python: member.setProperties(last_login_time=here.ZopeTime(),login_time=here.ZopeTime())" />

                <h1 i18n:translate="heading_welcome">Welcome!</h1>
                
                <p>
                <span i18n:translate="description_logged_in">
                    This is the first time that you've logged in to 
                    <span tal:replace="p_props/title" i18n:name="here">here</span>.
                </span> 
                
                <span i18n:translate="description_change_initial_password">
                Before you start exploring you need to change your original password. 
                This will ensure that the password we sent you via email cannot be used in a malicious manner.
                </span>
                </p>
                
                <p i18n:translate="description_use_form_to_change_password">
                Please use the form below to change your password.
                </p>
				
                <form class="group"
                      action="change_password"
                      name="change_password" 
                      method="post"
                      tal:attributes="action python: container.portal_url()+'/change_password'">

                    <span class="legend" i18n:translate="legend_password_details">Password Details</span>
                                    
                    <input type="hidden" 
                           name="came_from" 
                           value=""
                           tal:define="came_from request/came_from|nothing"
                           tal:condition="came_from"
                           tal:attributes="value came_from" 
                           />
                           
               
                    <div class="row">
                        <div class="label">
                            <span i18n:translate="label_new_password">New password</span>
                            <div id="new_password_help"
                                 i18n:translate="help_new_password" 
                                 class="help" 
                                 style="visibility:hidden">
                            Enter your new password. Minimum 5 characters.
                            </div>                
                            
                        </div>
                        <div class="field"> 
                            <input type="password" 
                                   name="password" 
                                   size="10"
                                   tabindex=""
                                   onfocus="formtooltip('new_password_help',1)" 
                                   onblur="formtooltip('new_password_help',0)"
                                   tal:attributes="tabindex tabindex/next;" 
                                   />
                        </div>
                    </div>
            
                    <div class="row">
                        <div class="label">
                            <span i18n:translate="label_confirm_password">Confirm password</span>
                            <div id="confirm_password_help" 
                                 i18n:translate="help_confirm_password"
                                 class="help" 
                                 style="visibility:hidden">
                            Re-enter the password. Make sure the passwords are identical.
                            </div>
                            
                        </div>
                        <div class="field"> 
                            <input type="password" 
                                   name="confirm" 
                                   size="10"
                                   tabindex=""
                                   onfocus="formtooltip('confirm_password_help',1)" 
                                   onblur="formtooltip('confirm_password_help',0)"
                                   tal:attributes="tabindex tabindex/next;" 
                                   />
                        </div>
                    </div>

                    <div class="row">
                        <div class="label"></div>
                        <div class="field">
                            <input type="submit" 
                                   name="submit" 
                                   value="Change Password"
                                   tabindex=""
                                   i18n:attributes="value"
                                   tal:attributes="tabindex tabindex/next;" />
                        </div>
                    </div>

                </form>
			
            </div>
			            
		</div>

	</div>

</div>

</body>
</html>

