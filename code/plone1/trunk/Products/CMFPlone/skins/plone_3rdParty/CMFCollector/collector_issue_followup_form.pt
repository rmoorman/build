<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<span tal:condition="nothing"
      tal:define="has_followup_priv nocall: here/do_action">
  This span ensures that the visitor has edit privilege, by fetching - but
  not displaying - the protected collector.do_action method.
</span>

<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:block metal:fill-slot="base">
  <tal:block tal:define="dummy python:request.set('enable_border',1)" />
</metal:block>


<span tal:condition="nothing">
  Template description: Form for entering new issue actions.
</span>

<div metal:fill-slot="header"
     tal:define="global collector_issue_header_present python: 1">
  <div metal:use-macro="here/collector_macros/macros/issue_header">
    ISSUE HEADER
  </div>
</div>

<div metal:fill-slot="main">

  <div tal:condition="not: collector_issue_header_present|nothing">
    <!-- Master template has no "header" macro... -->
    <div metal:use-macro="here/collector_macros/macros/issue_header">
      ISSUE HEADER
    </div>
  </div>

<div class="message" tal:condition="here/no_submitter_email">
    <img tal:replace="structure here/info.gif" />
    <span i18n:translate="no_mail_address">
    Note: We have no mail address for the submitters, so they won't
    get followups.
    </span>
</div>

  
<form class="group"
      method="post" 
      enctype="multipart/form-data"
      action=""
      tal:attributes="action string:${here/absolute_url}/collector_issue_followup"
      tal:define="actions_pairs here/valid_actions_pairs">

    <span class="legend" i18n:translate="legend_follow_up_details">Follow-up details</span>    


    <div class="row" tal:condition="actions_pairs">
        <div class="label" i18n:translate="label_collector_action">Action</div> 
        <div class="field">
            <input class="noborder"
                   type="radio" id="radio_action_comment"
                   name="action" value="comment" checked="checked" />
	    <label for="radio_action_comment" i18n:translate="label_do_comment">Comment</label>

            <span tal:repeat="pair actions_pairs">
                <span tal:define="name python:pair[0]; text python:pair[1];
		                  widget_id
				  string:radio_action_$name"
				  tal:condition="python: text != 'Assign'">
                    <input class="noborder" 
                           type="radio" 
                           name="action" 
                           value="VALUE"
                           tal:attributes="value name; id widget_id"
                     /><label tal:content="python: text"
		     tal:attributes="for widget_id" i18n:translate="">ACTION</label>
                </span>
            </span>

            <span tal:define="assigning python: [i[0] for i in actions_pairs
                                         if i[1] == 'Assign']"
                  tal:condition="assigning">
                <input class="noborder"
                       type="radio"
		       id="radio_action_Assign"
                       name="action" 
                       value="Assign"
                       tal:attributes="value python:
		       assigning[0]"/><label for="radio_action_Assign" i18n:translate="label_assign_to">Assign to:</label>
                <span tal:define="assigning python: [1 for i in actions_pairs
                                                     if i[1] == 'Assign'];
                                  supporters here/aq_parent/supporters"
                      tal:condition="assigning">
              
                    <select name="assignees:list" MULTIPLE size="5"
                            tal:attributes="size python:min(max(len(supporters), 3), 8)">
                        
                        <option tal:content="supporter"
                                tal:repeat="supporter supporters"
                                tal:attributes="selected python:supporter in here.assigned_to()">
                        SUPPORTER
                        </option>
                    </select>
                </span>
            </span>
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_follow_up">Follow-up</div> 
        <div class="field">
          <textarea name="comment" rows="10" cols="65" wrap="soft"
                    tal:content="python: (request.get('do_cite')
                                          and here.cited_text()) or ''">Prefix lines with whitespace or '&gt;' to preserve their format.</textarea>
        </div>
    </div>


          <span i18n:translate="click_to_cite">
          Click <a href="QUALIFIED" i18n:name="here"
                   tal:attributes="href python: request.URL + '?do_cite=1'">
                here</a> to cite the existing transcript.
          </span>

    <div class="row">
        <div class="label" i18n:translate="label_attachment_optional">Attachment (optional)</div> 
        <div class="field">
            <input type=file name="file" size="20" />
        </div>
    </div>

    <div class="row">
        <div class="label" i18n:translate="label_attachment_type_optional">Attachment type (optional)</div>
        <div class="field">
            <input class="noborder" type=radio name="filetype"
            value="File" id="radio_attachment_type_file" checked />
	    <label for="radio_attachment_type_file" i18n:translate="label_file">File</label>
            <input class="noborder" type=radio name="filetype"
            value="Image" id="radio_attachment_type_image" />
	    <label for="radio_attachment_type_image" i18n:translate="label_image">Image</label>
        </div>
    </div>
    
    <div class="row">
        <div class="label" i18n:translate="label_name_of_upload_optional">Name of upload (optional)</div>
        <div class="field">
            <input type=text name="fileid" size="12" />
        </div>
    </div>
    
    <div class="row">
        <div class="label">&nbsp;</div>
        <div class="field">
         <input class="context" type="submit" value="Submit"
        i18n:attributes="value" />
        </div>
    </div>

  </form>

</div>

</html>
